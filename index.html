<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>éœ“å–ƒ-æ™‚åŸŸå”è­°ï¼šæ—¥è•</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="logo.png">
    <link rel="icon" type="image/png" href="logo.png">

    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=SF+Pro+Display:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- åœ–ç‰‡è¨­å®š (æœ¬åœ° PNG) --- */
        :root {
            --logo-url: url('logo.png'); 
            --bg-day-pc: url('bg-day-pc.png');
            --bg-night-pc: url('bg-night-pc.png');
            --bg-day-mobile: url('bg-day-mobile.png');
            --bg-night-mobile: url('bg-night-mobile.png');
        }

        /* --- è®Šæ•¸è¨­å®š --- */
        :root {
            --ios-blue: #007AFF;
            --ios-gray-light: #F2F2F7;
            --ios-fill-light: rgba(118, 118, 128, 0.12);
            --text-main: #1d1d1f;
            --text-sub: #86868b;
            
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-border: rgba(255, 255, 255, 0.6);
            --shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            
            --radius-box: 28px;
            --radius-input: 12px;
            --radius-btn: 14px;
        }

        body.night-mode {
            --text-main: #f5f5f7;
            --text-sub: #86868b;
            --glass-bg: rgba(30, 30, 30, 0.7);
            --glass-border: rgba(255, 255, 255, 0.15);
            --shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            --ios-fill-light: rgba(255, 255, 255, 0.1);
        }

        * {
            box-sizing: border-box; margin: 0; padding: 0;
            transition: all 0.4s cubic-bezier(0.25, 0.1, 0.25, 1);
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Noto Sans TC", sans-serif;
        }

        html { scroll-behavior: smooth; }
        body {
            background-color: #000; color: var(--text-main);
            overflow-x: hidden; overflow-y: scroll;
            scroll-snap-type: y mandatory; 
        }

        .bg-fixed { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        .bg-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            transition: opacity 1.5s ease-in-out;
        }
        #bg-day { opacity: 1; background-image: var(--bg-day-pc); }
        #bg-night { opacity: 0; background-image: var(--bg-night-pc); }
        body.night-mode #bg-day { opacity: 0; }
        body.night-mode #bg-night { opacity: 1; }

        @media (max-width: 768px) {
            #bg-day { background-image: var(--bg-day-mobile); }
            #bg-night { background-image: var(--bg-night-mobile); }
        }

        section {
            width: 100vw; min-height: 100vh;
            display: flex; justify-content: center; align-items: center;
            padding: 20px; scroll-snap-align: start; position: relative;
        }

        /* --- Page 1: App --- */
        #app-section { z-index: 2; }
        
        .glass-container {
            width: 100%; max-width: 480px; 
            background: var(--glass-bg);
            backdrop-filter: saturate(180%) blur(25px); 
            -webkit-backdrop-filter: saturate(180%) blur(25px);
            border-radius: var(--radius-box); 
            border: 1px solid var(--glass-border);
            box-shadow: var(--shadow); 
            padding: 2.5rem;
            display: flex; flex-direction: column;
            gap: 1.2rem;
        }

        header { display: flex; flex-direction: column; align-items: center; margin-bottom: 0.5rem; text-align: center; }
        
        .logo {
            width: 150px; height: 150px; margin-bottom: 20px; 
            border-radius: 28px; 
            background-image: var(--logo-url); background-size: cover; background-position: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); cursor: pointer;
        }
        .logo:hover { transform: scale(1.05); }
        
        h1 { font-size: 1.8rem; font-weight: 700; letter-spacing: -0.02em; margin-bottom: 5px; color: var(--text-main); }
        .subtitle { font-size: 0.8rem; color: var(--text-sub); font-weight: 500; letter-spacing: 0.05em; text-transform: uppercase; }

        /* [ä¿®æ”¹] éæœŸæ™‚é–“é¡¯ç¤ºæ¨™ç±¤ - å¥¶æ²¹é‡‘é…è‰² */
        .expiry-badge {
            margin-top: 10px;
            font-size: 0.75rem;
            color: #f3d88a; /* æ‚¨çš„æŒ‡å®šè‰² */
            background: #2c2c2e; /* æ”¹ç‚ºæ·±è‰²èƒŒæ™¯ï¼Œç¢ºä¿æ·ºé‡‘è‰²æ–‡å­—æ¸…æ™°å¯è¦‹ */
            padding: 6px 14px;
            border-radius: 20px;
            font-weight: 600;
            letter-spacing: 0.5px;
            display: inline-block;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1); /* å¢åŠ ä¸€é»è³ªæ„Ÿé™°å½± */
        }
        body.night-mode .expiry-badge {
            background: rgba(255, 255, 255, 0.15); /* å¤œé–“æ¨¡å¼ç¶­æŒåŠé€æ˜ */
            color: #f3d88a; /* ç¶­æŒå¥¶æ²¹é‡‘ */
        }

        .input-group { display: flex; flex-direction: column; gap: 8px; }
        label { font-size: 0.8rem; font-weight: 600; color: var(--text-sub); margin-left: 4px; letter-spacing: 0; text-transform: uppercase; }
        input, textarea {
            width: 100%; background: var(--ios-fill-light);
            border: none; color: var(--text-main); padding: 16px;
            font-size: 1rem; border-radius: var(--radius-input);
        }
        input:focus, textarea:focus { outline: none; background: rgba(120, 120, 128, 0.2); transform: scale(1.01); }
        input:hover, textarea:hover { transform: scale(1.005); }
        textarea { resize: none; min-height: 110px; }

        .btn-group { display: flex; gap: 12px; margin-top: 0.5rem; }
        button {
            flex: 1; padding: 16px; border: none; border-radius: var(--radius-btn);
            font-size: 1rem; font-weight: 600; cursor: pointer; letter-spacing: -0.01em; 
        }
        .btn-encrypt { background: #f5e9c5; color: #fff; }
        body.night-mode .btn-encrypt { background: #f3d88a; color: #000000; }
        .btn-decrypt { background: var(--ios-fill-light); color: var(--text-main); }
        body.night-mode .btn-decrypt { background: rgba(255,255,255,0.1); }
        button:hover { transform: scale(1.02); filter: brightness(1.1); }
        button:active { transform: scale(0.96); }

        .output-area {
            background: var(--ios-fill-light); border-radius: var(--radius-input);
            padding: 16px; min-height: 80px; position: relative; margin-top: 0.5rem;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.05);
        }
        .output-label { position: absolute; top: -8px; left: 12px; background: var(--text-sub); color: #fff; padding: 2px 8px; font-size: 0.6rem; border-radius: 4px; font-weight: 700; }
        #result-display { font-family: 'SF Mono', 'Menlo', monospace; font-size: 0.9rem; word-break: break-all; opacity: 0; line-height: 1.4; }
        .status-msg { font-size: 0.8rem; text-align: center; margin-top: 10px; color: var(--ios-blue); font-weight: 500; min-height: 20px;}

        .scroll-indicator {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            color: #fff; text-shadow: 0 2px 5px rgba(0,0,0,0.5);
            opacity: 0.8; animation: bounce 2s infinite;
            font-size: 1.5rem; cursor: pointer; z-index: 10;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateX(-50%) translateY(0);}
            40% {transform: translateX(-50%) translateY(-10px);}
            60% {transform: translateX(-50%) translateY(-5px);}
        }

        /* --- Page 2: Info --- */
        #info-section { z-index: 2; padding-top: 80px; padding-bottom: 60px; overflow: hidden; }
        .info-container { width: 100%; max-width: 960px; display: flex; flex-direction: column; gap: 50px; padding: 0 20px; position: relative; }
        .info-header { text-align: center; }
        
        .info-title {
            font-size: 3.5rem; font-weight: 700; line-height: 1.1;
            color: #ffffff; text-shadow: 0 4px 10px rgba(0,0,0,0.5);
            margin-bottom: 20px; letter-spacing: -0.02em; 
        }
        .info-desc { 
            font-size: 1.3rem; color: #ffffff; text-shadow: 0 2px 5px rgba(0,0,0,0.5);
            max-width: 650px; margin: 0 auto; line-height: 1.5; text-align: center; font-weight: 500;
        }

        .features-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; }
        .feature-card {
            background: rgba(0, 0, 0, 0.4); 
            backdrop-filter: saturate(180%) blur(20px); -webkit-backdrop-filter: saturate(180%) blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2); 
            border-radius: 24px; padding: 40px 30px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .feature-card:hover { transform: translateY(-8px) scale(1.01) !important; box-shadow: 0 20px 40px rgba(0,0,0,0.3); }
        .icon-large { font-size: 3.5rem; margin-bottom: 20px; display: block; text-shadow: 0 2px 5px rgba(0,0,0,0.3); }
        .card-title { 
            font-size: 1.3rem; font-weight: 700; margin-bottom: 10px; color: #ffffff; 
            letter-spacing: -0.01em; text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        .card-text { 
            font-size: 1rem; color: rgba(255, 255, 255, 0.9); line-height: 1.5; 
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }
        .main-footer { 
            text-align: center; margin-top: 40px; color: #ffffff; 
            text-shadow: 0 2px 4px rgba(0,0,0,0.8); font-size: 0.75rem; 
        }

        @media (max-width: 768px) {
            .glass-container { padding: 2rem 1.5rem; max-width: 92%; }
            .info-title { font-size: 2.5rem; }
            .features-grid { grid-template-columns: 1fr; }
            .main-footer { margin-bottom: 40px; } 
        }

        .observe-target {
            opacity: 0; transform: translateY(30px);
            transition: opacity 0.8s cubic-bezier(0.16, 1, 0.3, 1), transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .fade-in-up { opacity: 1 !important; transform: translateY(0) !important; }
        .delay-100 { transition-delay: 0.1s; } 
        .delay-200 { transition-delay: 0.2s; }
        .delay-300 { transition-delay: 0.3s; } 
        .delay-400 { transition-delay: 0.4s; }
        .delay-500 { transition-delay: 0.5s; }
        @keyframes typeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .animate-result { animation: typeIn 0.5s ease-out forwards; }
    </style>
</head>
<body>
    <div class="bg-fixed">
        <div id="bg-day" class="bg-layer"></div>
        <div id="bg-night" class="bg-layer"></div>
    </div>

    <section id="app-section">
        <div class="glass-container">
            <header>
                <div class="logo"></div>
                <h1>éœ“å–ƒæ—¥è•</h1>
                <div class="subtitle">Temporal Protocol: Eclipse</div>
                <div id="key-expiry-display" class="expiry-badge">è¨ˆç®—ä¸­...</div>
            </header>
            
            <div class="input-group">
                <label>Access Key</label>
                <input type="text" id="password" placeholder="è¼¸å…¥è§£å¯†é‡‘é‘°..." autocomplete="off">
            </div>
            
            <div class="input-group">
                <label>Data Stream</label>
                <textarea id="input-text" placeholder="åœ¨æ­¤è¼¸å…¥è¨Šæ¯..."></textarea>
            </div>
            
            <div class="btn-group">
                <button class="btn-encrypt" onclick="processData('encrypt')">åŠ å¯†</button>
                <button class="btn-decrypt" onclick="processData('decrypt')">è§£å¯†</button>
            </div>
            
            <div class="output-area">
                <span class="output-label">OUTPUT</span>
                <div id="result-display"></div>
            </div>
            <div id="status-log" class="status-msg"></div>
        </div>
        
        <div class="scroll-indicator" onclick="document.getElementById('info-section').scrollIntoView({behavior: 'smooth'})">âŒ„</div>
    </section>

    <section id="info-section">
        <div class="info-container">
            <div class="info-header">
                <div class="info-title observe-target">æ™‚é–“ï¼Œæ˜¯å”¯ä¸€çš„é‘°åŒ™ã€‚</div>
                <div class="info-desc observe-target delay-100">
                    çµåˆè»è¦ AES-256 åŠ å¯†èˆ‡æ™‚é–“å› å­ã€‚<br>
                    éŒ¯éäº†ç•¶ä¸‹ï¼Œè¨Šæ¯å°‡æ°¸é æ¶ˆå¤±åœ¨æ™‚é–“çš„æ´ªæµä¸­ã€‚
                </div>
            </div>
            
            <div class="features-grid">
                <div class="feature-card observe-target delay-200">
                    <span class="icon-large">ğŸ›¡ï¸</span>
                    <div class="card-title">AES-256 GCM</div>
                    <div class="card-text">æ¡ç”¨ç¾åœ‹è¯é‚¦æ”¿åºœæ¨™æº–çš„åŠ å¯†ç®—æ³•ï¼Œé…åˆ GCM å®Œæ•´æ€§é©—è­‰ï¼Œç¢ºä¿æ•¸æ“šç„¡å¯ç¯¡æ”¹ã€‚</div>
                </div>
                <div class="feature-card observe-target delay-300">
                    <span class="icon-large">âš¡</span>
                    <div class="card-title">æœ¬åœ°ç«¯é‹ç®—</div>
                    <div class="card-text">åœ¨æ‚¨çš„è¨­å‚™ä¸Šé€²è¡Œæœ¬åœ°ç«¯é‹ç®—ã€‚å¯†ç¢¼èˆ‡æ•¸æ“šèˆ‡æ‚¨çš„è£ç½®å¯¸æ­¥ä¸é›¢ã€‚</div>
                </div>
                <div class="feature-card observe-target delay-400">
                    <span class="icon-large">â³</span>
                    <div class="card-title">æ—¥è•æ•ˆæ‡‰</div>
                    <div class="card-text">é‡‘é‘°èˆ‡ NSTåœ‹å®¶æ¨™æº–æ™‚é–“(UTC+8) ç¶å®šã€‚æ¯éš” 24 å°æ™‚é‡‘é‘°è‡ªå‹•éŠ·æ¯€ï¼Œæ˜¨æ—¥çš„å¯†æ–‡å°‡æ°¸ä¹…å¤±æ•ˆä¸å¾©æ‰¾å›ã€‚</div>
                </div>
            </div>

            <footer class="main-footer observe-target delay-500">
                <div id="copyright-text"></div>
                DESIGNED BY Ni Nan - Temporal Protocol: Eclipse
            </footer>
        </div>
    </section>

<script>
    // --- 1. å‹•ç•«ç›£è½ ---
    const observerOptions = { root: null, rootMargin: '0px', threshold: 0.15 };
    const observer = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                requestAnimationFrame(() => {
                    entry.target.classList.add('fade-in-up');
                });
                observer.unobserve(entry.target);
            }
        });
    }, observerOptions);
    document.querySelectorAll('.observe-target').forEach(el => { observer.observe(el); });

    // --- 2. æ—¥å¤œåˆ‡æ› èˆ‡ æ™‚é–“è¨ˆç®— ---
    function updateTimeAndTheme() {
        const now = new Date();
        const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
        const taiwanTime = new Date(utc + (3600000 * 8));
        const hour = taiwanTime.getHours();
        const year = taiwanTime.getFullYear();
        const isDay = hour >= 6 && hour < 18;
        
        if (isDay) { document.body.classList.remove('night-mode'); } 
        else { document.body.classList.add('night-mode'); }
        
        document.getElementById('copyright-text').innerHTML = `&copy;${year} éœ“å–ƒ-æ™‚åŸŸå”è­°ï¼šæ—¥è• ç‰ˆæ¬Šæ‰€æœ‰`;

        // è¨ˆç®—ä¸¦é¡¯ç¤ºé‡‘é‘°éæœŸæ™‚é–“
        const nowUTC = new Date();
        const nextMidnightUTC = new Date(Date.UTC(
            nowUTC.getUTCFullYear(),
            nowUTC.getUTCMonth(),
            nowUTC.getUTCDate() + 1,
            0, 0, 0
        ));
        
        const expireDateStr = nextMidnightUTC.toLocaleDateString('zh-TW', { month: '2-digit', day: '2-digit' });
        const expireTimeStr = nextMidnightUTC.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit', hour12: false });
        
        document.getElementById('key-expiry-display').textContent = `é‡‘é‘°å°‡æ–¼ ${expireDateStr} ${expireTimeStr} éæœŸ`;
    }
    updateTimeAndTheme(); 
    setInterval(updateTimeAndTheme, 1000);

    // --- 3. åŠ å¯†æ ¸å¿ƒé‚è¼¯ (ç¶²è·¯æ ¡æ™‚ + PBKDF2) ---

    function bufferToBase64(buffer) {
        let binary = '';
        const bytes = new Uint8Array(buffer);
        for (let i = 0; i < bytes.byteLength; i++) { binary += String.fromCharCode(bytes[i]); }
        return window.btoa(binary);
    }
    function base64ToBuffer(base64) {
        const binary_string = window.atob(base64);
        const bytes = new Uint8Array(binary_string.length);
        for (let i = 0; i < binary_string.length; i++) { bytes[i] = binary_string.charCodeAt(i); }
        return bytes.buffer;
    }

    async function getTrustedTimestamp() {
        const statusLog = document.getElementById('status-log');
        try {
            const response = await fetch('https://worldtimeapi.org/api/timezone/Etc/UTC', {
                cache: 'no-store', mode: 'cors'
            });
            if (!response.ok) throw new Error('API Error');
            const data = await response.json();
            return data.unixtime; 
        } catch (e) {
            console.warn("API Error, fallback to local.");
            statusLog.textContent = "âš ï¸ ç„¡æ³•é€£æ¥æ ¡æ™‚ä¼ºæœå™¨ï¼Œä½¿ç”¨æœ¬æ©Ÿæ™‚é–“...";
            statusLog.style.color = "#ffcc00";
            return Math.floor(Date.now() / 1000);
        }
    }

    async function deriveKey(password, salt) {
        const encoder = new TextEncoder();
        const nowSeconds = await getTrustedTimestamp();
        const dayId = Math.floor(nowSeconds / 86400); 
        
        const keyMaterialStr = password + "_" + dayId.toString();
        const keyMaterial = await crypto.subtle.importKey(
            "raw", encoder.encode(keyMaterialStr), { name: "PBKDF2" }, false, ["deriveKey"]
        );

        return await crypto.subtle.deriveKey(
            { name: "PBKDF2", salt: salt, iterations: 600000, hash: "SHA-256" },
            keyMaterial,
            { name: "AES-GCM", length: 256 },
            false,
            ["encrypt", "decrypt"]
        );
    }

    function typeWriterEffect(element, text) {
        element.textContent = text;
        element.classList.remove('animate-result');
        void element.offsetWidth; 
        element.classList.add('animate-result');
    }

    async function processData(mode) {
        const password = document.getElementById('password').value;
        const inputText = document.getElementById('input-text').value;
        const display = document.getElementById('result-display');
        const status = document.getElementById('status-log');
        
        status.textContent = "ç¶²è·¯æ ¡æ™‚èˆ‡é‹ç®—ä¸­..."; 
        status.style.color = "var(--text-sub)";
        
        if (!password || !inputText) {
            status.textContent = "è«‹è¼¸å…¥å¯†ç¢¼èˆ‡å…§å®¹"; status.style.color = "#ff3b30"; return;
        }

        try {
            const encoder = new TextEncoder(); 
            const decoder = new TextDecoder();

            if (mode === 'encrypt') {
                const salt = crypto.getRandomValues(new Uint8Array(16));
                const iv = crypto.getRandomValues(new Uint8Array(12));
                
                const key = await deriveKey(password, salt);
                
                const encodedData = encoder.encode(inputText);
                const encryptedContent = await crypto.subtle.encrypt(
                    { name: "AES-GCM", iv: iv }, key, encodedData
                );

                const combined = new Uint8Array(salt.byteLength + iv.byteLength + encryptedContent.byteLength);
                combined.set(salt, 0); combined.set(iv, 16);
                combined.set(new Uint8Array(encryptedContent), 28); 

                const result = bufferToBase64(combined.buffer);
                typeWriterEffect(display, result);
                status.textContent = "åŠ å¯†æˆåŠŸ (å·²æ ¡å°ç¶²è·¯æ™‚é–“)"; status.style.color = "var(--ios-blue)";

            } else {
                try {
                    const combinedBuffer = base64ToBuffer(inputText);
                    const combinedArray = new Uint8Array(combinedBuffer);

                    if (combinedArray.length < 28) throw new Error("Format Error");
                    
                    const salt = combinedArray.slice(0, 16);
                    const iv = combinedArray.slice(16, 28);
                    const ciphertext = combinedArray.slice(28);

                    const key = await deriveKey(password, salt);

                    const decryptedContent = await crypto.subtle.decrypt(
                        { name: "AES-GCM", iv: iv }, key, ciphertext
                    );

                    const result = decoder.decode(decryptedContent);
                    typeWriterEffect(display, result);
                    status.textContent = "è§£å¯†æˆåŠŸ"; status.style.color = "var(--ios-blue)";

                } catch (e) { throw new Error("Decrypt Failed"); }
            }
        } catch (err) {
            display.textContent = "";
            status.textContent = "å¯†ç¢¼éŒ¯èª¤ã€æ™‚æ•ˆå·²éæˆ–ç¶²è·¯ç•°å¸¸"; status.style.color = "#ff3b30";
        }
    }
</script>
</body>
</html>
